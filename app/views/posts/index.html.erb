<%= render 'shared/header' %>

<%= search_form_for @q, url: root_path, method: :get do |f| %>
  <div class="relative flex rounded-md">
    <%= f.search_field :title_cont, class: "w-[200px] py-3 px-4 pl-11 block border-gray-200 shadow-sm rounded-md text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400", placeholder: "タイトルを入力してください" %>
    <%= f.hidden_field :title %>
    <ul class="list-group bg-white absolute w-full md:text-sm max-w-max" data-autocomplete-target="results"></ul>
    <div class="absolute inset-y-0 left-0 flex items-center pointer-events-none pl-4">
      <svg class="h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
      </svg>
    </div>
    <%= f.submit "検索", class: "ml-4 py-3 px-4 inline-flex flex-shrink-0 justify-center items-center gap-2 rounded-md border border-transparent font-semibold bg-blue-500 text-white hover:bg-blue-600 focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-sm" %>
  </div>
<% end %>


<%= link_to 'スレッド一覧', sureddos_path, class: 'btn btn-primary' %>

<div class="main-content">
  <h3>動画投稿一覧！</h3>
  <% if params[:query].present? %>
    <h4>検索結果: "<%= params[:query] %>"</h4>
  <% end %>
  <div class="posts">
    <% @posts.each do |post| %>
      <div class="post">
        <% if post.video_file.attached? %>
          <video width="320" height="240" controls>
            <source src="<%= url_for(post.video_file) %>" type="video/mp4">
            お使いのブラウザでは動画再生に対応していません。
          </video>
        <% end %>

        <% if post.video_url.present? %>
          <% 
            video_id_match = post.video_url.match(/(?:https?:\/\/(?:www\.)?youtube\.com\/(?:[^\/\n\s]+\/\S+|(?:v|e(?:mbed)?)\/?([^\/\n\s]*))|youtu\.be\/([^\/\n\s]+))/)
            video_id = video_id_match ? (video_id_match[1] || video_id_match[2] || video_id_match[3]) : nil
          %>
          <% if video_id %>
            <iframe width="320" height="240" src="https://www.youtube.com/embed/<%= video_id %>" frameborder="0" allowfullscreen></iframe>
          <% end %>
        <% end %>
        <p>投稿者: <%= post.user_name %></p>
        <h4>タイトル: <%= link_to post.title, detail_post_path(post),  class: 'btn' %></h4>
        <p>説明欄: <%= post.description %></p>
      </div>
    <% end %>
  </div>
</div>
